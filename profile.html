
<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AI时尚搭配 - 用户画像</title>
  <link rel="stylesheet" href="css/tailwind.min.css">
  <link rel="stylesheet" href="css/all.min.css">
  <style>
    :root {
      --primary: #3A5EFF;
      --background: #F5F7FB;
      --accent: #FF7A45;
    }
    .card-shadow {
      box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
  </style>
</head>
<body class="bg-gray-50 font-sans">
  <!-- 主页面容器 -->
  <div class="max-w-md mx-auto min-h-screen flex flex-col bg-gray-100">
    <!-- 顶部导航 -->
    <header class="bg-white p-4 shadow-sm">
      <div class="flex items-center justify-between">
        <h1 class="text-xl font-bold text-blue-500">客户画像分析</h1>
        <button class="p-2 rounded-full hover:bg-gray-100">
          <i class="fas fa-sliders-h text-gray-600"></i>
        </button>
      </div>
    </header>

    <!-- 主要内容区 -->
    <main class="flex-1 p-4 overflow-y-auto">
      <!-- 搜索区 -->
      <div class="bg-white rounded-lg p-4 mb-4 card-shadow">
        <div class="relative mb-3">
          <input type="tel" id="phoneInput" placeholder="输入客户手机号" 
            class="w-full p-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
            maxlength="11" pattern="[0-9]{11}">
          <button id="searchBtn" class="absolute right-2 top-2 bg-blue-500 text-white p-1 rounded-lg">
            <i class="fas fa-search"></i>
          </button>
        </div>
        <div class="text-xs text-gray-500">
          <i class="fas fa-info-circle mr-1"></i>支持所有大陆手机号，包括虚拟运营商号段
        </div>
      </div>

      <!-- 客户信息 -->
      <div class="bg-white rounded-lg p-4 mb-4 card-shadow">
        <div class="flex items-center mb-3">
          <div class="w-12 h-12 rounded-full bg-gray-300 flex items-center justify-center mr-3">
            <i class="fas fa-user text-gray-500 text-xl"></i>
          </div>
          <div>
            <h2 class="font-semibold">张先生</h2>
            <p class="text-sm text-gray-500">138****1234</p>
          </div>
        </div>
        <div class="grid grid-cols-2 gap-2 mb-3">
          <div class="bg-gray-100 p-2 rounded">
            <p class="text-xs text-gray-500">年龄</p>
            <p class="font-medium">32岁</p>
          </div>
          <div class="bg-gray-100 p-2 rounded">
            <p class="text-xs text-gray-500">客单价</p>
            <p class="font-medium text-yellow-500">5k-8k</p>
          </div>
          <div class="bg-gray-100 p-2 rounded">
            <p class="text-xs text-gray-500">忠诚度</p>
            <p class="font-medium">高</p>
          </div>
          <div class="bg-gray-100 p-2 rounded">
            <p class="text-xs text-gray-500">消费潜力</p>
            <p class="font-medium">高</p>
          </div>
        </div>
      </div>

      <!-- 兴趣标签 -->
      <div class="bg-white rounded-lg p-4 mb-4 card-shadow">
        <h2 class="text-lg font-semibold mb-3">兴趣标签</h2>
        <div class="flex flex-wrap gap-2">
          <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">关注西服版型</span>
          <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">询问节日促销</span>
          <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">偏好深色系</span>
          <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">商务休闲风格</span>
          <span class="bg-blue-500 text-white px-3 py-1 rounded-full text-sm">注重面料舒适度</span>
        </div>
      </div>

      <!-- 聊天记录 -->
      <div class="bg-white rounded-lg p-4 mb-4 card-shadow">
        <div class="flex justify-between items-center mb-3">
          <h2 class="text-lg font-semibold">最近聊天记录</h2>
          <button class="text-sm text-blue-500">查看全部</button>
        </div>
        <div class="space-y-3">
          <div class="border-l-2 border-blue-500 pl-3">
            <p class="text-sm font-medium">2023-12-24 14:30</p>
            <p class="text-gray-600">"请问这款西服有修身版型吗？"</p>
          </div>
          <div class="border-l-2 border-blue-500 pl-3">
            <p class="text-sm font-medium">2023-11-11 10:15</p>
            <p class="text-gray-600">"双十一这款夹克有优惠吗？"</p>
          </div>
          <div class="border-l-2 border-blue-500 pl-3">
            <p class="text-sm font-medium">2023-09-28 16:45</p>
            <p class="text-gray-600">"我需要一套商务休闲的搭配建议"</p>
          </div>
        </div>
      </div>

      <!-- 购买记录 -->
      <div class="bg-white rounded-lg p-4 card-shadow">
        <div class="flex justify-between items-center mb-3">
          <h2 class="text-lg font-semibold">购买记录</h2>
          <div class="flex items-center">
            <button class="text-sm text-blue-500 mr-3">筛选</button>
            <button class="text-sm text-blue-500">按时间</button>
          </div>
        </div>
        
        <!-- 2023年Q4 -->
        <details open class="mb-3">
          <summary class="font-medium flex items-center justify-between cursor-pointer">
            <span>2023年 第4季度</span>
            <i class="fas fa-chevron-down text-sm transform transition-transform duration-200"></i>
          </summary>
          <div class="mt-2 space-y-2">
            <div class="flex items-center p-2 hover:bg-gray-50 rounded">
              <img src="https://images.unsplash.com/photo-1591047139829-d91aecb6caea?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                class="w-12 h-12 object-cover rounded mr-3">
              <div class="flex-1">
                <p class="text-sm font-medium">修身款西装外套</p>
                <p class="text-xs text-gray-500">2023-12-15  ¥3,899</p>
              </div>
              <span class="bg-yellow-500 text-white text-xs px-2 py-1 rounded">重复购买</span>
            </div>
            <div class="flex items-center p-2 hover:bg-gray-50 rounded">
              <img src="https://images.unsplash.com/photo-1529374255404-311a2a4f1fd9?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                class="w-12 h-12 object-cover rounded mr-3">
              <div class="flex-1">
                <p class="text-sm font-medium">纯棉商务衬衫</p>
                <p class="text-xs text-gray-500">2023-11-20  ¥899</p>
              </div>
            </div>
          </div>
        </details>
        
        <!-- 2023年Q3 -->
        <details class="mb-3">
          <summary class="font-medium flex items-center justify-between cursor-pointer">
            <span>2023年 第3季度</span>
            <i class="fas fa-chevron-down text-sm transform transition-transform duration-200"></i>
          </summary>
          <div class="mt-2 space-y-2">
            <div class="flex items-center p-2 hover:bg-gray-50 rounded">
              <img src="https://images.unsplash.com/photo-1473966968600-fa801b6a6016?ixlib=rb-1.2.1&auto=format&fit=crop&w=100&q=80" 
                class="w-12 h-12 object-cover rounded mr-3">
              <div class="flex-1">
                <p class="text-sm font-medium">修身牛仔裤</p>
                <p class="text-xs text-gray-500">2023-09-05  ¥1,299</p>
              </div>
            </div>
          </div>
        </details>
      </div>
    </main>

    <!-- 底部导航 -->
    <nav class="bg-white border-t border-gray-200 flex justify-around p-3">
      <a href="suggest.html" class="text-center text-gray-500">
        <i class="fas fa-home block text-xl"></i>
        <span class="text-xs">推荐</span>
      </a>
      <a href="profile.html" class="text-center text-blue-500">
        <i class="fas fa-user-tie block text-xl"></i>
        <span class="text-xs">画像</span>
      </a>
      <a href="try-on.html" class="text-center text-gray-500">
        <i class="fas fa-tshirt block text-xl"></i>
        <span class="text-xs">试衣</span>
      </a>
    </nav>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const phoneInput = document.getElementById('phoneInput');
      const searchBtn = document.getElementById('searchBtn');

      if (phoneInput) {
        const phone = sessionStorage.getItem('phone');
        if (phone) {
          phoneInput.value = phone;
        }
      }

      if (searchBtn && phoneInput) {
        searchBtn.addEventListener('click', function () {
          const phoneValue = phoneInput.value.trim();

          if (!/^[0-9]{11}$/.test(phoneValue)) {
            alert('请输入有效的11位手机号码！');
            return;
          }

          searchBtn.disabled = true;
          searchBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';

          fetch('https://dashscope.aliyuncs.com/api/v1/apps/634f4252baf241158dbbf5184795cbd5/completion', {
            method: 'POST',
            headers: {
              'Authorization': 'Bearer sk-c621672d066a4b3888496de777aabf94',
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              input: {
                prompt: `手机号码: ${phoneValue}, 选项: 客户画像`,
                biz_params: {
                  Phone: phoneValue
                }
              },
              parameters: {},
              debug: {}
            })
          })
          .then(async(response) => {
            searchBtn.disabled = false;
            searchBtn.innerHTML = '<i class="fas fa-search"></i>';
            
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return JSON.parse((await response.json()).output.text);
          })
          .then(data => {
            const customerData = data.Customer;
            const chatData = data.Chat;
            const orderData = data.Order;
            const productData = data.Product;

            // Update Customer Info Section
            document.querySelector('.flex.items-center.mb-3 h2').innerText = `${customerData.name}`;
            document.querySelector('.flex.items-center.mb-3 p').innerText = `${customerData.phone.slice(0, 3)}****${customerData.phone.slice(-4)}`;

            // Generate Interest Tags from Chat Data
            const tagContainer = document.querySelector('.flex.flex-wrap.gap-2');
            tagContainer.innerHTML = '';
            const uniqueTags = new Set();
            chatData.forEach(chat => {
              const message = chat.message.toLowerCase();
              if (message.includes('西服')) uniqueTags.add('关注西服版型');
              if (message.includes('促销')) uniqueTags.add('询问节日促销');
              if (message.includes('深色')) uniqueTags.add('偏好深色系');
              if (message.includes('商务休闲')) uniqueTags.add('商务休闲风格');
            });
            uniqueTags.forEach(tag => {
              const tagElement = document.createElement('span');
              tagElement.className = 'bg-blue-500 text-white px-3 py-1 rounded-full text-sm';
              tagElement.innerText = tag;
              tagContainer.appendChild(tagElement);
            });

            // Populate Recent Chat Records
            const chatRecords = document.querySelector('.space-y-3');
            chatRecords.innerHTML = '';
            chatData.slice(0, 3).forEach(chat => { // Show latest 3 chats
              const chatDiv = document.createElement('div');
              chatDiv.className = 'border-l-2 border-blue-500 pl-3';
              chatDiv.innerHTML = `
                <p class="text-sm font-medium">${new Date(chat.timestamp).toLocaleString()}</p>
                <p class="text-gray-600">"${chat.message}"</p>
              `;
              chatRecords.appendChild(chatDiv);
            });

            // Populate Purchase History
            const purchaseHistory = document.querySelector('.bg-white.rounded-lg.p-4.card-shadow');
            const detailsSections = purchaseHistory.querySelectorAll('details');
            detailsSections.forEach(details => details.remove());
            orderData.forEach(order => {
              const quarter = getQuarter(new Date(order.orderDate));
              let quarterSection = purchaseHistory.querySelector(`details[quarter="${quarter}"]`);
              if (!quarterSection) {
                quarterSection = document.createElement('details');
                quarterSection.setAttribute('quarter', quarter);
                quarterSection.className = 'mb-3';
                quarterSection.innerHTML = `
                  <summary class="font-medium flex items-center justify-between cursor-pointer">
                    <span>${quarter}</span>
                    <i class="fas fa-chevron-down text-sm transform transition-transform duration-200"></i>
                  </summary>
                  <div class="mt-2 space-y-2"></div>
                `;
                purchaseHistory.appendChild(quarterSection);
              }
              const product = productData.find(p => p.price === order.totalAmount);
              const productDiv = document.createElement('div');
              productDiv.className = 'flex items-center p-2 hover:bg-gray-50 rounded';
              productDiv.innerHTML = `
                <img src="${product.imageUrl}" class="w-12 h-12 object-cover rounded mr-3">
                <div class="flex-1">
                  <p class="text-sm font-medium">${product.productName}</p>
                  <p class="text-xs text-gray-500">${new Date(order.orderDate).toLocaleDateString()} ¥${order.totalAmount}</p>
                </div>
                <span class="bg-yellow-500 text-white text-xs px-2 py-1 rounded">重复购买</span>
              `;
              quarterSection.querySelector('.space-y-2').appendChild(productDiv);
            });
          })
          .catch(error => {
            searchBtn.disabled = false;
            searchBtn.innerHTML = '<i class="fas fa-search"></i>';
            console.error('Profile API error:', error);
            alert(`客户画像API调用失败: ${error.message}`);
          });
      });
    }

    // Helper function to determine quarter
    function getQuarter(date) {
      const month = date.getMonth() + 1;
      const year = date.getFullYear();
      const quarter = Math.ceil(month / 3);
      return `${year}年 第${quarter}季度`;
    }
  });
</script>
</body>
</html>
  